<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>â€“ Pepr Tutorials</title><link>/v0.23.1/pepr-tutorials/</link><description>Recent content in Pepr Tutorials on</description><generator>Hugo -- gohugo.io</generator><language>en</language><atom:link href="/v0.23.1/pepr-tutorials/index.xml" rel="self" type="application/rss+xml"/><item><title>V0.23.1: Tutorial - Create a Tutorial - Create a Pepr Module</title><link>/v0.23.1/pepr-tutorials/create-pepr-module/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>/v0.23.1/pepr-tutorials/create-pepr-module/</guid><description>
&lt;h2 id="introduction">Introduction&lt;/h2>
&lt;p>This tutorial will walk you through the process of creating a Pepr module.&lt;/p>
&lt;p>Each Pepr Module is it&amp;rsquo;s own Typescript project, produced by &lt;a href="../../user-guide/pepr-cli#pepr-init">&lt;code>npx pepr init&lt;/code>&lt;/a>. Typically a module is maintained by a unique group or system. For example, a module for internal &lt;a href="https://zarf.dev/">Zarf&lt;/a> mutations would be different from a module for &lt;a href="https://p1.dso.mil/products/big-bang">Big Bang&lt;/a>. An important idea with modules is that they are &lt;em>wholly independent of one another&lt;/em>. This means that 2 different modules can be on completely different versions of Pepr and any other dependencies; their only interaction is through the standard K8s interfaces like any other webhook or controller.&lt;/p>
&lt;h2 id="prerequisites">Prerequisites&lt;/h2>
&lt;h2 id="steps">Steps&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>Create the module&lt;/strong>:&lt;/p>
&lt;p>Use &lt;a href="../../user-guide/pepr-cli#pepr-init">&lt;code>npx pepr init&lt;/code>&lt;/a> to generate a new module.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Quickly validate system setup&lt;/strong>:&lt;/p>
&lt;p>Every new module includes a sample Pepr Capability called &lt;code>HelloPepr&lt;/code>. By default,
this capability is deployed and monitoring the &lt;code>pepr-demo&lt;/code> namespace. There is a sample
yaml also included you can use to see Pepr in your cluster. Here&amp;rsquo;s the quick steps to do
that after &lt;code>npx pepr init&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># cd to the newly-created Pepr module folder&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">cd&lt;/span> my-module-name
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># If you don&amp;#39;t already have a local K8s cluster, you can set one up with k3d&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>npm run k3d-setup
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># Launch pepr dev mode&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># If using another local K8s distro instead of k3d, use `npx pepr dev --host host.docker.internal`&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pepr dev
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># From another terminal, apply the sample yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl apply -f capabilities/hello-pepr.samples.yaml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># Verify the configmaps were transformed using kubectl, k9s or another tool&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>Create your custom Pepr Capabilities&lt;/strong>&lt;/p>
&lt;p>Now that you have confirmed Pepr is working, you can now create new &lt;a href="../../user-guide/capabilities/">capabilities&lt;/a>. You&amp;rsquo;ll also want to disable the &lt;code>HelloPepr&lt;/code> capability in your module (&lt;code>pepr.ts&lt;/code>) before pushing to production. You can disable by commenting out or deleting the &lt;code>HelloPepr&lt;/code> variable below:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">&lt;code class="language-typescript" data-lang="typescript">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">new&lt;/span> PeprModule(cfg, [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">// Remove or comment the line below to disable the HelloPepr capability
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span> HelloPepr,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">// Your additional capabilities go here
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span>]);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;em>Note: if you also delete the &lt;code>capabilities/hello-pepr.ts&lt;/code> file, it will be added again on the next &lt;a href="../../user-guide/pepr-cli#pepr-update">&lt;code>npx pepr update&lt;/code>&lt;/a> so you have the latest examples usages from the Pepr SDK. Therefore, it is sufficient to remove the entry from your &lt;code>pepr.ts&lt;/code> module
config.&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Build and deploy the Pepr Module&lt;/strong>&lt;/p>
&lt;p>Most of the time, you&amp;rsquo;ll likely be iterating on a module with &lt;code>npx pepr dev&lt;/code> for real-time feedback and validation Once you are ready to move beyond the local dev environment, Pepr provides deployment and build tools you can use.&lt;/p>
&lt;p>&lt;code>npx pepr deploy&lt;/code> - you can use this command to build your module and deploy it into any K8s cluster your current &lt;code>kubecontext&lt;/code> has access to. This setup is ideal for CI systems during testing, but is not recommended for production use. See &lt;a href="../../user-guide/pepr-cli#pepr-deploy">&lt;code>npx pepr deploy&lt;/code>&lt;/a> for more info.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="additional-information">Additional Information&lt;/h2>
&lt;p>By default, when you run &lt;code>npx pepr init&lt;/code>, the module is not configured with any additional options. Currently, there are 3 options you can configure:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>deferStart&lt;/code> - if set to &lt;code>true&lt;/code>, the module will not start automatically. You will need to call &lt;code>start()&lt;/code> manually. This is useful if you want to do some additional setup before the module controller starts. You can also use this to change the default port that the controller listens on.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>beforeHook&lt;/code> - an optional callback that will be called before every request is processed. This is useful if you want to do some additional logging or validation before the request is processed.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>afterHook&lt;/code> - an optional callback that will be called after every request is processed. This is useful if you want to do some additional logging or validation after the request is processed.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>You can configure each of these by modifying the &lt;code>pepr.ts&lt;/code> file in your module. Here&amp;rsquo;s an example of how you would configure each of these options:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">&lt;code class="language-typescript" data-lang="typescript">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">const&lt;/span> module &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> PeprModule(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> cfg,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">// Your capabilities go here
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span> ],
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> deferStart: &lt;span style="color:#8be9fd">true&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> beforeHook: &lt;span style="color:#8be9fd">req&lt;/span> &lt;span style="color:#ff79c6">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">// Any actions you want to perform before the request is processed, including modifying the request.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> afterHook: &lt;span style="color:#8be9fd">res&lt;/span> &lt;span style="color:#ff79c6">=&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">// Any actions you want to perform after the request is processed, including modifying the response.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// Do any additional setup before starting the controller
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">module&lt;/span>.start();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="summary">Summary&lt;/h2>
&lt;p>Checkout some examples of Pepr modules in the &lt;a href="https://github.com/defenseunicorns/pepr-excellent-examples">excellent examples repo&lt;/a>. If you have questions after that, please reach out to us on &lt;a href="https://kubernetes.slack.com/archives/c06dgh40ucb">Slack&lt;/a> or &lt;a href="https://github.com/defenseunicorns/pepr/issues">GitHub Issues&lt;/a>&lt;/p></description></item></channel></rss>